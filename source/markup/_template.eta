<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">

    <%~
      it.meta?.map(
        metadata => '<meta ' +
                      Object.entries(metadata).map(
                        ([name, content]) =>
                          `${name}="${typeof content == 'string'
                            ? content
                            : Object.entries(content).map(pair => pair.join('=')).join(', ')}"`
                      ).join(' ') +
                    '>'
      ).join('') || '';
    %>

    <%~
      it.gfonts ? '<link rel="preconnect" href="https://fonts.googleapis.com">' +
                  '<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>'
                : '';
    %>

    <title><%= it.title %></title>
    <meta name="description" content="<%= it.description %>">

    <%~
      it.gfonts?.map(
        font => `<link href="https://fonts.googleapis.com/css2?family=${font}&display=swap" rel="stylesheet">`
      ).join('') || '';
    %>

    <%~
      it.css?.map(
        url => `<link rel="stylesheet" href="${((url.startsWith('http://') || url.startsWith('https://')) ? url : '/assets' + (url.startsWith('/') ? url : '/' + url))}">`
      ).join('') || '';
    %>

    <%~
      it.js?.map(
        jsDef => `<script ${jsDef.mode ?? ''} ${jsDef.module ? 'type="module"' : ''} src="${((jsDef.path.startsWith('http://') || jsDef.path.startsWith('https://')) ? jsDef.path : '/assets' + (jsDef.path.startsWith('/') ? jsDef.path : '/' + jsDef.path))}"></script>`
      ).join('') || '';
    %>
  </head>
  <body>
    <div data-taxi>
      <div data-taxi-view>
        <%~ it.body %>
      </div>
    </div>
  </body>
</html>